**알아둘 것**  
- 자바스크립트를 알려면 클라이언트 사이드와 서버 사이드 둘 다에 포함되는 ES를 공부해야 한다.  
- 서버 사이드 자바스크립트는 ECMAScript 와 Node.js에서 제공하는 API를 포함한다.  
- Node.js 자체가 환경이다. 언어가 아니다.  


# 웹 브라우저는 어떻게 동작하는가  

## HTTP  
브라우저와 서버는 대부분 다른 컴퓨터에 있다.  
브라우저는 사용자 컴퓨터(어느나라의 어디의 누가 어떤 브라우저로 접속할지는 모른다)에 있고,  
서버는 모든 상황에, 최대한 많은 브라우저를 대응하려 노력한다. 심지어 익스 7,8까지도...  
(한국에서는 익스 9이상은 지원해줘야한다)  

브라우저와 서버는 통신을 해야 하는데, 이를 위해 서버사이드 프로그램과 브라우저가 약속을 한다.  
"http:// 는 **http** 라는 통신규약(서버와 브라우저간의 약속)을 사용해 정보를 교환하겠다는 뜻이다."  
브라우저가 서버에게 이니셜 요청을 했을때 주소창의 주소가 `https://www.naver.com` 이라면,  
"나는 통신을 `https` 로 할거고, `www.naver.com` 이라는 서버로 페이지를 요청할거야." 라는 뜻.  
도메인네임서버에서 도메인을 IP주소로 변환한 뒤, IP주소로 서버의 위치를 알고 연결해준다.  
만약 페이지를 요청하는 구문이 아무것도 없으면 서버는 메인페이지(index.html)을 보내는 것으로 기본 설정이 되어 있기에,  
브라우저는 네이버의 메인 페이지를 받게 된다.  

    파일은 어떻게 받지? -> 케이블을 타고 패킷으로!  
    컴퓨터가 갖고 있는 파일은 0과 1로 이루어진 이진수의 집합체.  
    패킷은 데이터를 일정한 크기로 자른 것이다.  
    그 패킷들이 순서대로 시냇물 흐르듯 전송된다고 해서 스트림(stream) 이라고 한다.  

## HTML/CSS 파싱  

클라이언트 사이드에서는 index.html 파일(순수한 텍스트파일)을 받아서 메모리에 올린 후 파싱(해석)한다.  
**파싱**은 사람이 보기 좋으라고 써둔 소스코드를 브라우저가 이해하고 실행할 수 있도록 해석하는 것이다.  
파일을 로드한(다운로드 받은) 상태에서 코드를 한 줄씩 읽다가  
의미가 있는 내용이면 메모리에 기억하는데, 그 유의미한 정보를 **토큰**이라고 한다.  

    HTML은 부자관계로 이루어진다. nesting, 중첩.  
    네스팅된 자식태그는 자식노드가 된다.  
    
만약 link태그를 만나 CSS를 로딩해야 할 때가 되면, HTML의 파싱을 중단하고 다시 http를 이용해 서버에게 요청한다.  
"나 style.css 라는 것 좀 줘."(모든 파일은 서버에 있으니까)  
서버는 해당 파일을 가지고 있는 곳에 가서 파일을 찾아서 패킷으로 잘라서 보낸다.  
클라이언트는 파일을 받아서 메모리에 올리고 **CSS 파싱**을 시작한다.  
CSS에는 선택자(selector)가 있고, 선택자와 선언블럭으로 이루어진 것을 룰셋이라고 부른다.  

      body{
          font-size : 16px;
      }

이 룰셋들을 파서가 읽고 메모리에 써둔다. "body는 font-size가 16픽셀이더라" 라고.  

CSS 파싱을 다 마치면 **CSSOM 트리**가 완성되고, HTML 파싱을 중단한 시점부터 다시 시작한다.  
HTML 파싱을 다 마치면 **DOM 트리**가 완성된다.  

DOM 트리(HTML의 파싱결과)와 CSSOM 트리(CSS의 파싱결과)가  
브라우저가 관리하고있는 메모리에 자료구조로 만들어지면   
DOM 트리와 CSSOM 트리를 합쳐서(merge) 렌더트리(렌더링 하기위한 트리)를 만든다.  
이 렌더트리를 가지고 드디어 화면에 그리기 시작한다.  

이 모든 일은 브라우저안에있는 **렌더링 엔진**이라는 프로그램이 한다.  


## 자바스크립트 파싱  
자바스크립트의 처리는 **자바스크립트엔진**이라는 프로그램이 한다.  
HTML 파싱을 하다가 스크립트 태그를 만나면 HTML파싱이 멈춘다.  
이것을 **블로킹**이 걸렸다고 한다.  
스크립트 태그가 src 속성을 안 가지고 있다면 스크립트가 내장되어 있는 것이고,  
src 속성을 가지고 있다면 서버에서 파일을 가져온다.  

자바스크립트 엔진은 소스코드를 분석하며 의미를 갖는 최소 단위인 토큰들로 분리한다.  

`var a = 0;` 일 때
`var`, `a`, `=`, `0`, `;` 이 모두 토큰이다.
    
그리고 토큰들의 집합을 파싱하면서 **신택스 트리**, AST(Abstract Syntax Tree)를 만든다.  

(자바스크립트엔진이 자바스크립트문법으로 이해했다는 뜻.  
이해할 수 있다면 실행할 수 있다는 뜻이고, 명령을 할 수 있다는 뜻이다.)  

파싱한 상태에서 바이트코드로 한 번 더 바꾼 후 실행을 하는데,  
이때 돔과 관련이 있다면 **돔을 조작**할 수 있게 된다.  
만약 스크립트가 헤드에 있다면 돔트리가 완성이 안된 상태라서 돔 조작이 불가능하다.  
자바스크립트는 돔트리와 씨솜트리가 완성된 상태에서 실행해야 의미가 있다.  

    - 그럼에도 스크립트태그를 헤드에 써야 한다면...)  
    async: 병렬처리. 비동기. HTML파싱이 안 끝나도 js파싱이 끝나면 바로 실행한다.  
    defer: 파싱은 빨리하고 실행은 HTML 파싱이 끝나고 나중에 한다.  
    (그러나 둘 다 IE9이하에서는 지원이 안 되거나 부분지원 된다고 하니 그냥 body태그 아래에 쓰도록 하자)  
